<p><?xml version="1.0" encoding="Shift_JIS"?>
<!DOCTYPE html PUBLIC
"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS" />
<link rev="made" href="mailto:info@mutoys.com" />
<link rel="index" href="index.html" />
<link href="manual.css" type="text/css" rel="stylesheet" />
<title>SOLD OUT MANUAL 2004-03-18</title>
</head>
<body>
<h1 class="title">SOLD OUT MANUAL 2004-03-18</h1>
<p><a href="index.html">総合目次</a> &gt; <a href="customize.html">カスタマイズ目次</a> &gt; 商品データ記述文法</p>
<hr /></p>
<p>SOLD OUT カスタマイズの文法とコマンドの説明です。</p>
<ul><li>
<a href="#1">はじめに</a>
</li>
<li>
<a href="#2">文法</a>
<ul><li>
<a href="#3">基本構文</a>
</li>
<li>
<a href="#4">大文字小文字の同一視</a>
</li>
<li>
<a href="#5">区切り</a>
</li>
<li>
<a href="#6">改行とスペース(区切り)の扱い</a>
</li>
<li>
<a href="#7">コメント(注釈)</a>
</li>
<li>
<a href="#8">変数</a>
</li>
<li>
<a href="#9">数値</a>
</li>
<li>
<a href="#10">単位</a>
</li>
<li>
<a href="#11">文字列</a>
</li></ul></li>
<li>
<a href="#%40%40DEFINE">@@DEFINE</a>
<ul><li>
<a href="#13">Set</a>
</li>
<li>
<a href="#14">Scale</a>
</li>
<li>
<a href="#15">Type</a>
</li>
<li>
<a href="#16">MaxMoney</a>
</li>
<li>
<a href="#17">CostShowCase</a>
</li>
<li>
<a href="#18">TimeEditShowCase</a>
</li>
<li>
<a href="#19">TimeSendItem</a>
</li>
<li>
<a href="#20">TimeSendMoney</a>
</li>
<li>
<a href="#21">TimeUseTimeRate</a>
</li>
<li>
<a href="#22">Version</a>
</li>
<li>
<a href="#23">Job</a>
</li></ul></li>
<li>
<a href="#%40%40ITEM">@@ITEM</a>
<ul><li>
<a href="#25">no</a>
</li>
<li>
<a href="#26">type</a>
</li>
<li>
<a href="#27">code</a>
</li>
<li>
<a href="#28">name</a>
</li>
<li>
<a href="#29">info</a>
</li>
<li>
<a href="#30">price</a>
</li>
<li>
<a href="#31">limit</a>
</li>
<li>
<a href="#32">pop</a>
</li>
<li>
<a href="#33">scale</a>
</li>
<li>
<a href="#34">plus</a>
</li>
<li>
<a href="#35">base</a>
</li>
<li>
<a href="#36">cost</a>
</li>
<li>
<a href="#37">point</a>
</li>
<li>
<a href="#38">flag</a>
</li>
<li>
<a href="#39">funct _local_</a>
</li>
<li>
<a href="#40">funcs _local_</a>
</li>
<li>
<a href="#41">funcb _local_</a>
</li></ul></li>
<li>
<a href="#%40%40USE">@@USE</a>
<ul><li>
<a href="#43">name</a>
</li>
<li>
<a href="#44">price</a>
</li>
<li>
<a href="#45">time</a>
</li>
<li>
<a href="#46">exptime</a>
</li>
<li>
<a href="#47">exp</a>
</li>
<li>
<a href="#48">scale</a>
</li>
<li>
<a href="#49">info</a>
</li>
<li>
<a href="#50">action</a>
</li>
<li>
<a href="#51">arg</a>
</li>
<li>
<a href="#52">argmessage</a>
</li>
<li>
<a href="#53">argselect</a>
</li>
<li>
<a href="#54">okmsg</a>
</li>
<li>
<a href="#55">ngmsg</a>
</li>
<li>
<a href="#56">needexp</a>
</li>
<li>
<a href="#57">need</a>
</li>
<li>
<a href="#58">use</a>
</li>
<li>
<a href="#59">get</a>
</li>
<li>
<a href="#60">func</a>
</li>
<li>
<a href="#61">func _local_</a>
</li>
<li>
<a href="#62">func _local_?</a>
</li>
<li>
<a href="#63">funci _local_</a>
</li>
<li>
<a href="#64">funci _local_i?</a>
</li>
<li>
<a href="#65">param</a>
</li>
<li>
<a href="#66">funcb _local_</a>
</li>
<li>
<a href="#67">job</a>
</li></ul></li>
<li>
<a href="#%40%40EVENT">@@EVENT</a>
<ul><li>
<a href="#69">start</a>
</li>
<li>
<a href="#70">basetime</a>
</li>
<li>
<a href="#71">plustime</a>
</li>
<li>
<a href="#72">code</a>
</li>
<li>
<a href="#73">group</a>
</li>
<li>
<a href="#74">startmsg</a>
</li>
<li>
<a href="#75">endmsg</a>
</li>
<li>
<a href="#76">info</a>
</li>
<li>
<a href="#77">startfunc</a>
</li>
<li>
<a href="#78">startfunc _local_</a>
</li>
<li>
<a href="#79">endfunc</a>
</li>
<li>
<a href="#80">endfunc _local_</a>
</li>
<li>
<a href="#81">func</a>
</li>
<li>
<a href="#82">func _local_</a>
</li>
<li>
<a href="#83">param</a>
</li></ul></li>
<li>
<a href="#%40%40INCLUDE">@@INCLUDE</a>
</li>
<li>
<a href="#%40%40FUNCITEM">@@FUNCITEM</a>
<ul><li>
<a href="#86">perlコード記述</a>
</li>
<li>
<a href="#87">package item</a>
</li>
<li>
<a href="#88">関数引数</a>
</li>
<li>
<a href="#89">関数戻り値</a>
</li>
<li>
<a href="#90">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCEVENT">@@FUNCEVENT</a>
<ul><li>
<a href="#92">package event</a>
</li>
<li>
<a href="#93">関数引数</a>
</li>
<li>
<a href="#94">関数戻り値</a>
</li>
<li>
<a href="#95">使用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCUPDATE">@@FUNCUPDATE</a>
<ul><li>
<a href="#97">package main</a>
</li>
<li>
<a href="#98">関数引数</a>
</li>
<li>
<a href="#99">関数戻り値</a>
</li>
<li>
<a href="#100">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCINIT">@@FUNCINIT</a>
<ul><li>
<a href="#102">package main</a>
</li>
<li>
<a href="#103">関数引数</a>
</li>
<li>
<a href="#104">関数戻り値</a>
</li>
<li>
<a href="#105">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCBASE">@@FUNCBASE</a>
<ul><li>
<a href="#107">package main</a>
</li>
<li>
<a href="#108">関数引数</a>
</li>
<li>
<a href="#109">関数戻り値</a>
</li>
<li>
<a href="#110">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCTURN">@@FUNCTURN</a>
<ul><li>
<a href="#112">package main</a>
</li>
<li>
<a href="#113">関数引数</a>
</li>
<li>
<a href="#114">関数戻り値</a>
</li>
<li>
<a href="#115">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCCUSTOM">@@FUNCCUSTOM</a>
<ul><li>
<a href="#117">package main</a>
</li>
<li>
<a href="#118">関数引数</a>
</li>
<li>
<a href="#119">関数戻り値</a>
</li>
<li>
<a href="#120">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCNEW">@@FUNCNEW</a>
<ul><li>
<a href="#122">package main</a>
</li>
<li>
<a href="#123">関数引数</a>
</li>
<li>
<a href="#124">関数戻り値</a>
</li>
<li>
<a href="#125">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCSHOPIN">@@FUNCSHOPIN</a>
<ul><li>
<a href="#127">package main</a>
</li>
<li>
<a href="#128">関数引数</a>
</li>
<li>
<a href="#129">関数戻り値</a>
</li>
<li>
<a href="#130">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCSHOPOUT">@@FUNCSHOPOUT</a>
<ul><li>
<a href="#132">package main</a>
</li>
<li>
<a href="#133">関数引数</a>
</li>
<li>
<a href="#134">関数戻り値</a>
</li>
<li>
<a href="#135">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCSALE">@@FUNCSALE</a>
<ul><li>
<a href="#137">package item</a>
</li>
<li>
<a href="#138">関数引数</a>
</li>
<li>
<a href="#139">関数戻り値</a>
</li>
<li>
<a href="#140">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40FUNCBUY">@@FUNCBUY</a>
<ul><li>
<a href="#142">package item</a>
</li>
<li>
<a href="#143">関数引数</a>
</li>
<li>
<a href="#144">関数戻り値</a>
</li>
<li>
<a href="#145">利用可能変数</a>
</li></ul></li>
<li>
<a href="#%40%40IF">@@IF</a>
</li>
<li>
<a href="#%40%40SETMACRO">@@SETMACRO</a>
</li>
<li>
<a href="#%40%40USEMACRO">@@USEMACRO</a>
</li>
<li>
<a href="#%40%40ITEMNO">@@ITEMNO</a>
</li>
<li>
<a href="#%40%40VALUE">@@VALUE</a>
</li>
<li>
<a href="#%40%40END">@@END</a>
</li></ul><h2 class="section"><small><a href="#top">△</a></small> <a name="1" id="1">はじめに</a></h2>
<p>この説明書では<code class="filename">soldout/inc/inc-item-data.cgi</code>の記述方法(文法やコマンド)を説明します。
説明だけでは分かりにくい部分もありますので、
併せて <code class="filename">soldout/inc/inc-item-data.cgi</code> を記述サンプルとして参照してください。。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="2" id="2">文法</a></h2>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="3" id="3">基本構文</a></h3>
<p>@@コマンド [コマンド毎の記述 [コマンド毎の記述 [...]]]</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="4" id="4">大文字小文字の同一視</a></h3>
<p>コマンド名やコマンド毎のパラメータ名は大文字小文字を同一視します。
以下は全て同一と見なされます。</p>
<pre class="display">
@@DEFINE SCALE 個
@@define scale 個
@@Define Scale 個
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="5" id="5">区切り</a></h3>
<p>コマンドやコマンド毎の記述の区切りはスペースもしくはタブです。
全角スペースは区切りとは見なされません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="6" id="6">改行とスペース(区切り)の扱い</a></h3>
<p>文字列を記述する場合を除き、改行や余分なスペースは無視されます。</p>
<p>※例外として、コマンド
<a href="#%40%40INCLUDE">@@INCLUDE</a>,
<a href="#%40%40IF">@@IF</a>,
<a href="#%40%40SETMACRO">@@SETMACRO</a>,
<a href="#%40%40USEMACRO">@@USEMACRO</a>,
<a href="#%40%40ITEMNO">@@ITEMNO</a>
は 1 行で記述する必要があります。</p>
<p>例えば、</p>
<pre class="display">
@@DEFINE Scale 個
</pre><p>と</p>
<pre class="display">
@@DEFINE
    Scale 個
</pre><p>は同一と見なされます。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="7" id="7">コメント(注釈)</a></h3>
<p>シャープ(#)から改行まではコメントと見なされ、無視されます。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="8" id="8">変数</a></h3>
<p><a href="#%40%40DEFINE">@@DEFINE</a> コマンドの set で変数を定義できます。
内容は文字列等に使用/展開できます。</p>
<pre class="display">
@@DEFINE set my_name MU
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="9" id="9">数値</a></h3>
<p>コマンド毎の記述のパラメータの一種です。基本的に数字のみ使用可能です。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="10" id="10">単位</a></h3>
<p>数値に以下の文字を付け加えると補正計算されます。</p>
<p>%:確率用(*10) k:キロ(*1000) m:分(*60) h:時(*60*60) d:日(*60*60*24)</p>
<pre class="display">
1d == 1 *60*60*24 == 86400
120m == 120 *60 == 7200
25% == 250
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="11" id="11">文字列</a></h3>
<p>コマンド毎の記述のパラメータの一種です。
「区切り」以外の文字が使用可能です。
「$変数名」を含めると変数内容が展開されます。</p>
<pre class="display">
正: 私はMUです
正: 私は$my_nameです
誤: 私は MU です (区切り文字が含まれています)
誤: 私は $my_name です (区切り文字が含まれています)
</pre><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40DEFINE" id="%40%40DEFINE">@@DEFINE</a></h2>
<p>基本データや変数の定義を行います。</p>
<p>基本データとは、商品の基本設定にあたります。
商品データのバージョン表記や、各種設定(陳列棚の維持費設定など)を行います。</p>
<p>また、商品生成に便利な「変数」の定義も可能です。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="13" id="13">Set</a></h3>
構文 <code>Set [変数名:文字列(0-9a-zA-Z_)] [変数内容:文字列]</code><br /><p><strong>変数設定</strong></p>
<p>設定した変数は<a href="#%40%40IF">@@IF</a>で利用したり文字列に埋め込んだり出来ます。</p>
<pre class="display">
@@DEFINE Set my_name MU
@@DEFINE Set i_am 私は$my_nameです
@@IF my_name ne MU @@END
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="14" id="14">Scale</a></h3>
構文 <code>Scale [単位:文字列]</code><br /><p><strong>デフォルト単位設定</strong></p>
<p>全商品のデフォルトの数え単位を設定します。</p>
<pre class="display">
@@DEFINE Scale 個
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="15" id="15">Type</a></h3>
構文 <code>Type [分類番号:数値(1〜)] [分類名:文字列]</code><br /><p><strong>分類定義</strong></p>
<p>商品の分類を定義します。自由に追加可能です。</p>
<p>分類番号 0 は無分類(商品全体)を指す分類になります。</p>
<pre class="display">
@@DEFINE Type 0 全
@@DEFINE Type 1 分類1
@@DEFINE Type 2 分類2
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="16" id="16">MaxMoney</a></h3>
構文 <code>MaxMoney [最大金額:数値(1〜)]</code><br /><p><strong>資金最大額設定</strong></p>
<p>資金の最大額を設定します。</p>
<pre class="display">
@@DEFINE MaxMoney 999999
# 最大を\999999に設定
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="17" id="17">CostShowCase</a></h3>
構文 <code>CostShowCase [棚番号:数値(1〜)] [維持費額:数値(円)]</code><br /><p><strong>陳列棚維持費設定</strong></p>
<p>陳列棚維持費の設定です。棚数別に設定できます。</p>
<pre class="display">
@@DEFINE
    CostShowCase 1 1000 # 陳列棚1個時の維持費
    CostShowCase 2 2000 # 陳列棚2個時の維持費
    CostShowCase 3 3000 # 陳列棚3個時の維持費
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="18" id="18">TimeEditShowCase</a></h3>
構文 <code>TimeEditShowCase [陳列時間:数値(秒)]</code><br /><p><strong>陳列時間設定</strong></p>
<p>陳列にかかる時間の設定です。</p>
<pre class="display">
@@DEFINE TimeEditShowCase 10m
# 10分
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="19" id="19">TimeSendItem</a></h3>
構文 <code>TimeSendItem [商品送付時間:数値(秒)]</code><br /><p><strong>送付時間設定</strong></p>
<p>商品送付にかかる時間を設定します。</p>
<pre class="display">
@@DEFINE TimeSendItem 1h
# 1時間
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="20" id="20">TimeSendMoney</a></h3>
構文 <code>TimeSendMoney [送金時間:数値(秒)]</code><br /><p><strong>送金時間設定</strong></p>
<p>送金にかかる時間を設定します。</p>
<pre class="display">
@@DEFINE TimeSendMoney 1.5h
# 1時間30分
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="21" id="21">TimeUseTimeRate</a></h3>
構文 <code>TimeUseTimeRate [補正率:数値(倍率)]</code><br /><p><strong>商品使用時間補正</strong></p>
<p>全ての商品使用時間を一括補正します。</p>
<pre class="display">
@@DEFINE TimeUseTimeRate 0.5
# 全商品の使用時間を0.5倍(1/2)に
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="22" id="22">Version</a></h3>
構文 <code>Version [バージョン:文字列]</code><br /><p><strong>バージョン設定</strong></p>
<p>商品のバージョン設定です。</p>
<pre class="display">
@@DEFINE Version オリジナル商品1.0
</pre><p>特殊キーワードとして、 RCS の $Revision: 1.11 $ を認識します。
その場合は、バージョン記述をダブルクォート("")で囲んでください。</p>
<pre class="display">
@@DEFINE Version &quot;オリジナル $Revision: 1.11 $&quot;
# &quot;オリジナル 1.0&quot; と認識
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="23" id="23">Job</a></h3>
構文 <code>Job [職業コード:文字列(a-z)10文字以下] [職業名:文字列]</code><br /><p><strong>職業設定</strong></p>
<p>職業コードと、対する職業名を設定します。</p>
<pre class="display">
@@DEFINE
    Job fighter 戦士
    Job mage 魔法使い
</pre><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40ITEM" id="%40%40ITEM">@@ITEM</a></h2>
<p>商品(商品)の定義を行います。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="25" id="25">no</a></h3>
構文 <code>no [番号:数値(1〜)]</code><br /><p><strong>商品番号</strong></p>
<p>商品に付けられる番号です。他の商品の番号とは重複出来ません。</p>
<p>番号は 1 から順番に使用してください。
飛び番号等で使われていない番号があると、その分システムに負荷がかかります。</p>
<pre class="display">
@@ITEM no 1
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="26" id="26">type</a></h3>
構文 <code>type [分類:文字列]</code><br /><p><strong>商品分類</strong></p>
<p><a href="#%40%40DEFINE">@@DEFINE</a>の<a href="#15">Type</a>で定義した分類を記述します。</p>
<pre class="display">
@@ITEM type 分類1
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="27" id="27">code</a></h3>
構文 <code>code [コード:文字列(0-9a-zA-Z_)]</code><br /><p><strong>商品コード</strong></p>
<p>商品に付けられるコードです。他の商品のコードとは重複出来ません。</p>
<pre class="display">
@@ITEM code test_item
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="28" id="28">name</a></h3>
構文 <code>name [名称:文字列]</code><br /><p><strong>商品名称</strong></p>
<p>商品の名称です。他の商品の名称と重複可能です。</p>
<pre class="display">
@@ITEM name テスト商品
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="29" id="29">info</a></h3>
構文 <code>info [説明:文字列]</code><br /><p><strong>説明</strong></p>
<pre class="display">
@@ITEM info テスト商品の説明です
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="30" id="30">price</a></h3>
構文 <code>price [価格:数値(円)]</code><br /><p><strong>標準価格(\)</strong></p>
<pre class="display">
@@ITEM price 12345
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="31" id="31">limit</a></h3>
構文 <code>limit [倉庫最大数:数値(個)]/[市場最大数:数値(個)]</code><br /><p><strong>倉庫最大数/市場最大数</strong></p>
<p>倉庫に確保できる最大数と、市場に出回る最大数を設定します。</p>
<p>史上最大数の設定は省略可能で、省略した場合は倉庫最大数と同じとみなされます。</p>
<dl><dt>
市場最大数が正の場合</dt>
<dd>
街全体で「設定値×店舗数(小数切捨)」が最大数となります。店舗数に応じて市場の最大値が変化します。
</dd>
<dt>
市場最大数が負の場合</dt>
<dd>
街全体で「-設定値」が最大数となります。店舗数とは無関係に市場の最大数が決まります。
</dd></dl><pre class="display">
@@ITEM limit 10
@@ITEM limit 10/5
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="32" id="32">pop</a></h3>
構文 <code>pop [売れ行き時間:数値(秒)]</code><br /><p><strong>売れ行き時間設定</strong></p>
<p>[売れ行き時間]に 1 個売れる確率になります。
ただし、実際の売れ行きは<code class="filename">soldout/_config.cgi</code>の売れ行き率補正設定に左右されます。</p>
<pre class="display">
@@ITEM pop 1h
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="33" id="33">scale</a></h3>
構文 <code>scale [数え単位:文字列]</code><br /><p><strong>数え単位</strong></p>
<p>この設定がない場合は、<a href="#%40%40DEFINE">@@DEFINE</a> <a href="#14">Scale</a> が使われます。</p>
<pre class="display">
@@ITEM scale 台
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="34" id="34">plus</a></h3>
構文 <code>plus [入荷時間:数値(秒)]</code><br /><p><strong>市場入荷/減少率</strong></p>
<p>市場在庫の変化を設定します。</p>
<dl><dt>
[入荷時間]が正の場合</dt>
<dd>
設定時間に1個入荷する確率となります。
</dd>
<dt>
[入荷時間]が負の場合</dt>
<dd>
ー設定時間に1個減少する確率となります。
</dd></dl><pre class="display">
@@ITEM plus 10m
@@ITEM plus -10m
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="35" id="35">base</a></h3>
構文 <code>base [基準個数:数値(個)]/[半額個数:数値(個)]</code><br /><p><strong>市場での価格変動設定</strong></p>
<p>在庫が基準個数時は標準価格で、半額個数時に半額になる。
その比率で、基準個数以下の場合はプレミアが付く。</p>
<pre class="display">
@@ITEM base 100/2000
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="36" id="36">cost</a></h3>
構文 <code>cost [維持費:数値(円)]</code><br /><p><strong>1 個あたりの維持費額</strong></p>
<p>未設定時は price の 1/10 が自動設定される。</p>
<pre class="display">
@@ITEM cost 100
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="37" id="37">point</a></h3>
構文 <code>point [補正率:数値(%)]</code><br /><p><strong>売却時の人気上昇率補正</strong></p>
<p>100%で± 0 。未設定時は 100%。</p>
<pre class="display">
@@ITEM point 200%
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="38" id="38">flag</a></h3>
構文 <code>flag [属性:文字列]</code><br /><p><strong>商品属性</strong></p>
<p>[属性]に特定のキーワードを記述することで、その商品に各種属性を付けることが出来ます。</p>
<p>キーワードは複数記述可能です。その場合はそれぞれのキーワードを「|」で区切ってください。</p>
<p>属性キーワード一覧</p>
<dl><dt>
noshowcase</dt>
<dd>
陳列販売することが出来なくなります。
</dd>
<dt>
nosend</dt>
<dd>
他店舗へ送付することが出来なくなります。
</dd>
<dt>
notrash</dt>
<dd>
破棄することが出来なくなります。
</dd>
<dt>
notradein</dt>
<dd>
輸入することが出来なくなります。(貿易システム有効時のみ)
</dd>
<dt>
notradeout</dt>
<dd>
輸出することが出来なくなります。(貿易システム有効時のみ)
</dd>
<dt>
nobuy</dt>
<dd>
他店の陳列棚からは購入できなくなります。
</dd></dl><pre class="display">
@@ITEM flag nosend|notrash # 送付と破棄は不可
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="39" id="39">funct _local_</a></h3>
<p><strong>独自関数呼び出し</strong></p>
<p>ターン更新時(デフォルトでは 5 分以上の間隔)に実行される処理を perl で記述できます。</p>
<p>関数定義は、この宣言文の次行から「 _local_ 」が記述されている行までで行います。</p>
<p>「持っているだけでリアルタイムな効果がある商品」や、
「いつのまにか変化している商品(成長等)」が実現できます。
(プレイヤーがログインしていない状況で商品毎の特殊処理が出来るということです)</p>
<p>なお、この方法で定義された関数は、
ターン更新時に毎回実行されますので、
高負荷がかかる処理はお勧めできません。
また、その商品を持っているプレイヤーがいない場合は、処理されません。</p>
<p>処理の際は、前回更新からの経過秒数になる$TIMESPAN を利用できます。
例えば、 1 秒に\1 の収入という効果の場合は、「->{money}+=$TIMESPAN 」と出来ます。
「実際の更新間隔は不定期」なので、時間に応じた処理の場合は注意しましょう。</p>
<p>関数の引数は($ITEM[この商品番号],@DT[この商品を持っているプレイヤーのリスト])です。
戻り値は破棄されます(利用されません)。</p>
<p>package item です。</p>
<pre class="display">
@@ITEM funct _local_
    my($ITEM,@DT)=@_;
    foreach my $DT (@DT)
    {
        $DT-&gt;{money} += $TIMESPAN;
    }
    return;
_local_
# この商品持っていると1秒につき\1資金が増えるという処理
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="40" id="40">funcs _local_</a></h3>
<p><strong>売却時独自関数呼び出し</strong></p>
<p>ターン更新処理で商品が売却された時に実行される処理を perl で記述できます。</p>
<p>関数定義は、この宣言文の次行から「 _local_ 」が記述されている行までで行います。</p>
<p>「売れると別の商品が手に入る」や、
「売却時に何らかのイベントを起こす」等が実現できます。
(売却をトリガーにして任意の処理が出来るということです)</p>
<p>ただし、この処理は店舗間の取引では実行されません。
店舗間取引時の処理には<a href="#41">funcb _local_</a>を利用します。</p>
<p>なお、この方法で定義された関数は、
ターン更新時に毎回実行されますので、
高負荷がかかる処理はお勧めできません。</p>
<p>関数の引数は($ITEM[この商品番号],$DT,売却数,売却合計額)です。
戻り値は 0 を指定してください。</p>
<p>package item です。</p>
<pre class="display">
@@ITEM funcs _local_
    my($ITEM,$DT,$count,$price)=@_;
    $DT-&gt;{moneystock}-=($price/2);
    $DT-&gt;{money}+=($price/2);
    return 0;
_local_
# この商品が売れると、売り上げの1/2が自動的に入金庫から資金へ移動します。
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="41" id="41">funcb _local_</a></h3>
<p><strong>仕入時独自関数呼び出し</strong></p>
<p>市場や他店から購入する際に実行される処理を perl で記述できます。</p>
<p>関数定義は、この宣言文の次行から「 _local_ 」が記述されている行までで行います。</p>
<p>「購入するとおまけの商品が付いてくる」や、
「購入されると自店の最近の出来事に履歴が残る」等が実現できます。
(購入をトリガーにして任意の処理が出来るということです)</p>
<p>ただし、この処理は店舗間の取引でのみ実行されます。
ゲーム内仮想住人による購入時の処理には<a href="#40">funcs _local_</a>を利用します。</p>
<p>関数の引数は($item::BUY(連想配列のリファレンス))です。
戻り値は 0 を指定してください。</p>
<p>$item::BUY の構造は以下の通りです。</p>
<dl><dt>
dt</dt>
<dd>
自店データ($DT)
</dd>
<dt>
dts</dt>
<dd>
他店or市場データ($DTS)
</dd>
<dt>
whole</dt>
<dd>
dts($DTS)が他店か市場かを表すデータ (0:他店 0以外:市場)
</dd>
<dt>
item</dt>
<dd>
商品データ($ITEM[商品番号])
</dd>
<dt>
itemno</dt>
<dd>
商品番号
</dd>
<dt>
num</dt>
<dd>
購入数
</dd>
<dt>
price</dt>
<dd>
購入(支払)単価
</dd>
<dt>
baseprice</dt>
<dd>
相手($DTS)の売上額
</dd>
<dt>
tax</dt>
<dd>
相手($DTS)の売却税
</dd>
<dt>
guild</dt>
<dd>
ギルド間取引状況 (0:非ギルド間取引 1:同ギルド間取引 2:異ギルド間取引 -1:同ギルド間取引(資金不足))
</dd>
<dt>
guildmargin</dt>
<dd>
ギルド間割引/割増額
</dd></dl><p>$DTS が他店か市場かどうかの判定は $item::BUY->{whole} の真偽もしくは
$DTS->{_wholestore_} が存在するかどうかで行ってください。</p>
<p>package item です。</p>
<pre class="display">
@@ITEM funcb _local_
    my($BUY)=@_;
    AddItemSub(@@ITEMNO&quot;福引券&quot;,int($BUY-&gt;{num}*$BUY-&gt;{price}/10000),$BUY-&gt;{dt}) if $BUY-&gt;{num}*$BUY-&gt;{price}&gt;=10000;
    return 0;
_local_
# この商品を買うと、\10,000に付き1枚の福引券(商品)が手に入る。
</pre><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40USE" id="%40%40USE">@@USE</a></h2>
<p>商品(<a href="#%40%40ITEM">@@ITEM</a>)に付加する「商品の使用方法」を定義します。
通常、<a href="#%40%40ITEM">@@ITEM</a>と組み合わせて記述します。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="43" id="43">name</a></h3>
構文 <code>name [使用名:文字列]</code><br /><p><strong>使用時名称</strong></p>
<pre class="display">
@@USE name 使ってみる
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="44" id="44">price</a></h3>
構文 <code>price [費用:数値(円)]</code><br /><p><strong>使用費用</strong></p>
<pre class="display">
@@USE price 1000
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="45" id="45">time</a></h3>
構文 <code>time [消費時間:数値(秒)]</code><br /><p><strong>熟練度 0%時の商品使用消費時間</strong></p>
<pre class="display">
@@USE time 4h
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="46" id="46">exptime</a></h3>
構文 <code>exptime [消費時間:数値(秒)]</code><br /><p><strong>熟練度 100%時の商品使用消費時間</strong></p>
<pre class="display">
@@USE exptime 2h
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="47" id="47">exp</a></h3>
構文 <code>exp [取得熟練度:数値(%)]</code><br /><p><strong>熟練度上昇ポイント</strong></p>
<p>ポイントは商品毎に蓄積されます。</p>
<pre class="display">
@@USE exp 10%
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="48" id="48">scale</a></h3>
構文 <code>scale [数え単位:文字列]</code><br /><p><strong>使用回数数え単位</strong></p>
<pre class="display">
@@USE scale 回
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="49" id="49">info</a></h3>
構文 <code>info [説明:文字列]</code><br /><p><strong>説明</strong></p>
<pre class="display">
@@USE info 使うといいことがあるかもしれません
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="50" id="50">action</a></h3>
構文 <code>action [行動:文字列]</code><br /><p><strong>決定ボタン表示名</strong></p>
<pre class="display">
@@USE action 使う
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="51" id="51">arg</a></h3>
構文 <code>arg [パラメータタイプ:文字列]</code><br /><p><strong>使用時パラメータ選択</strong></p>
<p>[パラメータタイプ] に target と記述することで、
対象店舗を選択出来るようになり、
商品使用時に呼び出される関数内で $DTS が定義されます。
これには相手店舗の $DT 構造体が格納されています。</p>
<p>[パラメータタイプ] に nocount と記述することで、
使用回数を 1 回に限定することが出来ます。</p>
<p>[パラメータタイプ] に message と記述することで、
商品使用時にコメントを入力できるようになります。
message40 という風に数値を付け加えると、
入力文字数(半角)を制限できます。
デフォルトは 80 文字です。
コメントは、 SJIS に変換後、指定文字数に切り詰められ、
&amp;&lt;&gt;&quot; はエスケープされます。
入力されたコメントは、 func 内で $USE->{arg}->{message} として利用できます。
併せて<a href="#52">argmessage</a>も参照してください。</p>
<p>[パラメータタイプ] に select と記述することで、
商品使用時に、あらかじめ設定された選択肢のリストボックスから
パラメータを選択できるようになります。
選択されたパラメータは、 func 内で $USE->{arg}->{select} として利用できます。
併せて<a href="#53">argselect</a>も参照してください。</p>
<p>[パラメータタイプ] に select|radio と記述することで、
radio タイプの選択肢にすることができます。
内容は select と同じです。</p>
<p>[パラメータタイプ] に select|list と記述することで、
全選択肢を一面表示するリストボックスタイプの選択肢にすることができます。
内容は select と同じです。</p>
<p>複数のパラメータタイプを記述したい場合は、「|」で区切ります。</p>
<pre class="display">
@@USE arg target|nocount|message40
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="52" id="52">argmessage</a></h3>
構文 <code>argmessage [メッセージ:文字列]</code><br /><p><strong>コメント入力説明</strong></p>
<p>arg に message を指定した場合に、入力する内容を説明するためのメッセージです。</p>
<pre class="display">
@@USE argmessage コメントをどうぞ
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="53" id="53">argselect</a></h3>
構文 <code>argselect [見出しメッセージ:文字列];[パラメータ1];[パラメータ1見出し];[パラメータ2];[パラメータ2見出し]...</code><br /><p><strong>パラメータ選択説明&amp;選択肢</strong></p>
<p>arg に select を指定した場合に、入力する内容を説明するための見出しメッセージと、
選択肢(パラメータ&amp;見出し)の設定を行います。</p>
<p>見出しメッセージ、パラメータ、パラメータ見出しの区切りはカンマ(;)です。
また、メッセージやパラメータにスペースやタブ(\t)を含めることは出来ません。</p>
<p>パラメータには英数字のみを使用してください。</p>
<pre class="display">
@@USE argselect 好きな色を選択してください;1;赤;2;緑;3;青
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="54" id="54">okmsg</a></h3>
構文 <code>okmsg [成功メッセージ:文字列]</code><br /><p><strong>使用成功時メッセージ</strong></p>
<pre class="display">
@@USE okmsg 無事成功しました
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="55" id="55">ngmsg</a></h3>
構文 <code>ngmsg [失敗メッセージ:文字列]</code><br /><p><strong>使用失敗時メッセージ</strong></p>
<pre class="display">
@@USE ngmsg 残念ながら失敗したようです
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="56" id="56">needexp</a></h3>
構文 <code>needexp [必要熟練度:数値(%)]</code><br /><p><strong>必要熟練度設定</strong></p>
<p>実行に必要な熟練度の設定です。設定しない場合は 0% と見なされます。</p>
<pre class="display">
@@USE needexp 50%
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="57" id="57">need</a></h3>
構文 <code>need [個数:数値(個)] [商品名:商品名or商品コード]</code><br /><p><strong>必要商品設定(消費なし)</strong></p>
<pre class="display">
@@USE need 10 テスト商品
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="58" id="58">use</a></h3>
構文 <code>use [個数:数値(個)] [商品名:商品名or商品コード] [消費確率:数値(倍率)] [消費時メッセージ:文字列]</code><br /><p><strong>使用商品設定</strong></p>
<p>[消費確率]で商品を消費した場合、[消費時メッセージ]を表示します。</p>
<p>消費時メッセージは省略可能で、消費時メッセージを省略した場合に限り、消費確率も省略できます。
消費確率を省略した場合は、 100%消費するものとみなされます。</p>
<pre class="display">
@@USE use 10 テスト商品
@@USE use 10 テスト商品 10%
@@USE use 10 テスト商品 10% 消費しました
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="59" id="59">get</a></h3>
構文 <code>get [個数:数値(個)] [商品名:商品名or商品コード] [取得確率:数値(倍率)] [取得時メッセージ:文字列]</code><br /><p><strong>取得商品設定</strong></p>
<p>[取得確率]で商品を取得した場合、[取得時メッセージ]を表示します。</p>
<p>取得時メッセージは省略可能で、取得時メッセージを省略した場合に限り、取得確率も省略できます。
取得確率を省略した場合は、 100%取得するものとみなされます。</p>
<pre class="display">
@@USE get 10 テスト商品
@@USE get 10 テスト商品 50%
@@USE get 10 テスト商品 50% 手に入れました
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="60" id="60">func</a></h3>
構文 <code>func [関数名:文字列(0-9a-zA-Z_)]</code><br /><p><strong>(書式 1) 独自関数呼び出し</strong></p>
<p>商品を使用したときに独自の処理を行いたい場合使用します
関数定義は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> で行います。</p>
<p>引数はありませんが、$DT $USE @ITEM $DTS(arg target 時のみ) 等が利用できます。</p>
<p>戻り値は画面に表示される文字列です。
表示されるだけですので、システム上のログに残ることはありません。
ログ(最近の出来事)に残したいときは、<code class="filename">soldout/inc/inc-item.cgi</code> に定義されている WriteLog 関数を利用できます。</p>
<pre class="display">
@@USE func test_func
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="61" id="61">func _local_</a></h3>
<p><strong>(書式 2) 独自関数呼び出し</strong></p>
<p>商品を使用したときに独自の処理を行いたい場合使用します</p>
<p>関数定義は次行から「 _local_ 」が記述されている行までで行います。
ここで定義された関数は _local_ 番号 という名称になり、
同じ <a href="#%40%40ITEM">@@ITEM</a> に属する <a href="#%40%40USE">@@USE</a> で再利用できます。
定義番号は、定義された順に _local_1 _local_2 _local_3 となります。</p>
<p>引数や戻り値の扱いは(書式 1)と同じです。</p>
<p>なお、この方法で定義された関数は必要時にしか読み込まれませんので、負荷軽減に繋がります。
package item です。</p>
<pre class="display">
@@USE func _local_
    $DT-&gt;{money} += 1000;
_local_
# 使用すると\1000増える処理
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="62" id="62">func _local_?</a></h3>
構文 <code>func _local_[定義番号:数値(1〜)]</code><br /><p><strong>(書式 3) ローカル関数呼び出し</strong></p>
<p>既に、同じ <a href="#%40%40ITEM">@@ITEM</a> に属する <a href="#%40%40USE">@@USE</a> <a href="#61">func _local_</a> がある場合に、その関数を呼び出します。
関数名は、定義された順に _local_1 _local_2 となっています。</p>
<p>引数と戻り値の扱いは(書式 1)と同じです。</p>
<pre class="display">
@@USE func _local_1
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="63" id="63">funci _local_</a></h3>
<p><strong>(書式 1) 説明文出力関数呼び出し</strong></p>
<p>商品を使用するページに独自の HTML 出力を追加したい場合に使用します</p>
<p>関数定義は次行から「 _local_ 」が記述されている行までで行います。
ここで定義された関数は _local_i 番号 という名称になり、
同じ <a href="#%40%40ITEM">@@ITEM</a> に属する <a href="#%40%40USE">@@USE</a> で再利用できます。
定義番号は、定義された順に _local_i1 _local_i2 _local_i3 となります。</p>
<p>引数はありませんが、$DT $USE @ITEM 等が利用できます。</p>
<p>戻り値は画面に表示される文字列です。
表示されるだけですので、システム上のログに残ることはありません。</p>
<p>package item です。</p>
<pre class="display">
@@USE funci _local_
    return '&lt;p&gt;&lt;strong&gt;この商品を使うと凄いことが起こるかもしれません&lt;/strong&gt;&lt;/p&gt;';
_local_
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="64" id="64">funci _local_i?</a></h3>
構文 <code>funci _local_[定義番号:数値(1〜)]</code><br /><p><strong>(書式 2) 説明文出力関数呼び出し</strong></p>
<p>既に、同じ <a href="#%40%40ITEM">@@ITEM</a> に属する <a href="#%40%40USE">@@USE</a> <a href="#63">funci _local_</a> がある場合に、
その関数を呼び出します。
関数名は、定義された順に _local_i1 _local_i2 となっています。</p>
<p>引数と戻り値の扱いは(書式 1)と同じです。</p>
<pre class="display">
@@USE func _local_i1
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="65" id="65">param</a></h3>
構文 <code>param [パラメータ:文字列]</code><br /><p><strong>独自関数用パラメータ</strong></p>
<p>独自関数へ渡すパラメータです。$USE->{param1} で参照できます。
カンマ(,)で区切ることで最大 4 つまで記述できます。
その場合は $USE->{param2} $USE->{param3} $USE->{param4} で参照できます。</p>
<pre class="display">
@@USE param 1,100,test,param
# $USE-&gt;{param1}='1';
# $USE-&gt;{param2}='100';
# $USE-&gt;{param3}='test';
# $USE-&gt;{param4}='param';
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="66" id="66">funcb _local_</a></h3>
<p><strong>使用前独自関数呼び出し</strong></p>
<p>商品の使用可否を検査する直前と、使用する「直前」に呼び出される処理を記述します。
動的に$USE の内容を変更できます。</p>
<p>関数定義は次行から「 _local_ 」が記述されている行までで行います。</p>
<p>引数はその<a href="#%40%40USE">@@USE</a>に対応する$USE です。また、$DT には自店のデータが設定されています。</p>
<p>戻り値は 0 or 1 or 2 です。</p>
<ul><li>
0: 正常終了
</li>
<li>
1: その@@USEは無条件に使用不可(表示は？？？？？？になる)
</li>
<li>
2: その@@USEは無条件に使用不可(表示は $USE->{name} になる)
</li></ul><p>「特定の条件(資金額など)をクリアしていなければ使用できない」等の処理が可能です。</p>
<p>なお、この方法で定義された関数は必要時にしか読み込まれませんので、負荷軽減に繋がります。
package item です。</p>
<pre class="display">
@@USE funcb _local_
    my($USE)=@_;
    
    if($DT-&gt;{money}&lt;10000)
    {
        return 1;
    }
    elsif($DT-&gt;{money}&gt;=100000)
    {
        $USE-&gt;{name}.='[所持金が多すぎます]';
        return 2;
    }
    return 0;
_local_
# 資金\10000未満では使用不可
# 資金\100000以上ではメッセージ付きの使用不可
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="67" id="67">job</a></h3>
構文 <code>job [職業名:文字列] [操作キー名:文字列(0-9a-zA-Z_)] [=+-*/] [設定値::文字列or数値]</code><br /><p><strong>職業別設定補正</strong></p>
<p><a href="#%40%40USE">@@USE</a>内の各種パラメータを職業によって変更することができます。</p>
<p>利用できるキー名が<a href="#%40%40USE">@@USE</a>内のキーになる以外は、<a href="#%40%40EVENT">@@EVENT</a> <a href="#83">param</a> と同じです。詳しくはそちらをご覧下さい。
例外として、操作キー名 times が追加されています。 times は time と exptime の両方を同時操作します。</p>
<pre class="display">
@@USE job 戦士 price * 10
# 職業が戦士の場合は使用時の費用(price)を10倍
</pre><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40EVENT" id="%40%40EVENT">@@EVENT</a></h2>
<p>イベントの定義を行います。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="69" id="69">start</a></h3>
構文 <code>start [発動確率:数値(倍率)]</code><br /><p><strong>イベント発動確率</strong></p>
<p>24 時間に対してのイベント発動確率です。
ただし、実際にイベントが発動するかどうかは startfunc の結果(戻り値)で最終決定されます。
(startfunc が定義されていない場合は、無条件で発動します。)</p>
<p>0%に設定すると「常に発動します」ので、 startfunc と組み合わせてください。</p>
<p>-1 に設定すると「発動しません」。
商品使用や他のイベントから独自関数経由で発動させたりする場合に有効な設定です。</p>
<pre class="display">
@@EVENT start 100%
# 1日に1回発動するかもしれない
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="70" id="70">basetime</a></h3>
構文 <code>basetime [発動期間基本:数値(秒)]</code><br /><p><strong>イベント発動期間</strong></p>
<p>イベントが発動したら最低でもこの設定期間は持続します。</p>
<p>ただし、この期間を終了しても、実際にイベントが終了するかどうかは endfunc の結果(戻り値)で最終決定されます。
(endfunc が定義されていない場合は、無条件で終了します。)</p>
<pre class="display">
@@EVENT basetime 12h
# 発動したら最低でも12時間は持続する
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="71" id="71">plustime</a></h3>
構文 <code>plustime [発動期間追加:数値(秒)]</code><br /><p><strong>イベント発動追加期間</strong></p>
<p>basetime にランダムで 0 〜 plustime(秒) を追加します。</p>
<pre class="display">
@@EVENT plustime 12h
# 発動期間のバラツキが0〜12時間になる
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="72" id="72">code</a></h3>
構文 <code>code [コード:文字列(0-9a-zA-Z_)]</code><br /><p><strong>コード(イベント毎ユニーク)</strong></p>
<pre class="display">
@@EVENT code test
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="73" id="73">group</a></h3>
構文 <code>group [コード:文字列(0-9a-zA-Z_)]</code><br /><p><strong>グループコード</strong></p>
<p>グループコードが設定されると、同じグループコードを持つイベントとは同時に発動しません。</p>
<p>例えば、「薬の人気が上がるイベント」と
「薬の人気が下がるイベント」を作成した場合、
共に同じグループコードを設定するとどちらか片方しか発動しないようになります。
グループコードを設定しなければ両方同時に発動する可能性があります。</p>
<pre class="display">
@@EVENT group test
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="74" id="74">startmsg</a></h3>
構文 <code>startmsg [開始メッセージ:文字列]</code><br /><p><strong>発動開始時のメッセージ</strong></p>
<pre class="display">
@@EVENT startmsg 発動しました
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="75" id="75">endmsg</a></h3>
構文 <code>endmsg [終了メッセージ:文字列]</code><br /><p><strong>発動終了時のメッセージ</strong></p>
<pre class="display">
@@EVENT endmsg 終了しました
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="76" id="76">info</a></h3>
構文 <code>info [発動中メッセージ:文字列]</code><br /><p><strong>発動中のメッセージ</strong></p>
<pre class="display">
@@EVENT info ただいま発動中
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="77" id="77">startfunc</a></h3>
構文 <code>startfunc [関数名:文字列(0-9a-zA-Z_)] ( [パラメータ:文字列] )</code><br /><p><strong>(書式 1) イベント発動条件判断の関数呼び出し</strong></p>
<p><a href="#69">start</a> でイベント発動の際、<a href="#%40%40FUNCEVENT">@@FUNCEVENT</a> で定義した関数を呼び出します。
パラメータは @_ で渡されます。
パラメータは省略できます。
その場合は括弧ごと省略してください。</p>
<p>呼び出された関数では @DT @ITEM が利用できます。</p>
<p>その戻り値が真(!=0)の場合、イベントが発動します。
偽(0)の場合は発動しません。</p>
<p>戻り値がリストで[1]にメッセージがある場合は最近の出来事に出力します。</p>
<pre class="display">
@@EVENT startfunc test_func('パラメータ')
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="78" id="78">startfunc _local_</a></h3>
構文 <code>startfunc _local_ ( [パラメータ:文字列] )</code><br /><p><strong>(書式 2) イベント発動条件判断の関数呼び出し</strong></p>
<p>イベント発動条件判断の関数を、次行から「 _local_ 」が記述されている行までで行います。
つまり、書式 1 の関数をローカル定義する方法です。その他に違いはありません。</p>
<p>なお、この方法で定義された関数は必要時にしか読み込まれませんので、負荷軽減に繋がります。
package event です。</p>
<pre class="display">
@@EVENT startfunc _local_ (25,300)
    my($itemno,$rate)=@_;
    
    foreach my $DT (@DT)
    {
        next if !$DT-&gt;{item}[$itemno-1];
        next if rand(1000)&gt;$rate;
        $DT-&gt;{money}+=100000;
    }
    return 0,'配当がありました';
_local_
# 商品番号25を所持した店舗には
# 30%(300)の確率で資金に+\100000
# イベント自体は発動しない
# (この関数自体がイベントの本体とみなされる)
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="79" id="79">endfunc</a></h3>
構文 <code>endfunc [関数名:文字列(0-9a-zA-Z_)] ( [パラメータ:文字列] )</code><br /><p><strong>(書式 1) イベント終了条件判断の関数呼び出し</strong></p>
<p>basetime+rand(plustime) が経過してイベント終了の際、
<a href="#%40%40FUNCEVENT">@@FUNCEVENT</a> で定義した関数を呼び出します。
パラメータは @_ で渡されます。</p>
<p>その戻り値が真(!=0)の場合、イベントが終了します。偽(0)の場合は終了しません。</p>
<p>戻り値がリストで[1]にメッセージがある場合は最近の出来事に出力します。</p>
<pre class="display">
@@EVENT endfunc test_func_end('パラメータ')
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="80" id="80">endfunc _local_</a></h3>
構文 <code>endfunc _local_ ( [パラメータ:文字列] )</code><br /><p><strong>(書式 2) イベント終了条件判断の関数呼び出し</strong></p>
<p>startfunc _local_ の endfunc 版です。</p>
<p>なお、この方法で定義された関数は必要時にしか読み込まれませんので、負荷軽減に繋がります。</p>
<pre class="display">
@@EVENT endfunc _local_ (11)
    my($itemno)=@_;
    foreach my $DT (@DT)
    {
        $DT-&gt;{item}[$itemno-1]=0 if $DT-&gt;{item}[$itemno-1];
    }
    return 1,'全店舗の'.$ITEM[$itemno-1]-&gt;{name}.'が回収されました';
_local_
# 全店舗の商品番号11の所持数を0にし、イベント終了
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="81" id="81">func</a></h3>
構文 <code>func [関数名:文字列(0-9a-zA-Z_)] ( [パラメータ:文字列] )</code><br /><p><strong>(書式 1) ターン処理時関数呼び出し</strong></p>
<p>ターン処理時に呼び出すイベント用関数の設定です。
関数本体は<a href="#%40%40FUNCEVENT">@@FUNCEVENT</a>で定義します。</p>
<p>そのイベントが発動している間のターン処理では、常に呼び出されます。
パラメータは @_ で渡されます。</p>
<p>戻り値は最近の出来事に出力されます。'' や 0 が返された場合は出力しません。</p>
<p>ターン処理は不定期(プレイヤーのアクセス頻度による)なので、
$TIMESPAN 変数から得られる「前回更新時刻からの経過秒数」を頼りにイベント処理を行うといいでしょう。</p>
<p>それ以外は startfunc や endfunc と共通です。</p>
<pre class="display">
@@EVENT func test_turn(1,2,3,4,5)
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="82" id="82">func _local_</a></h3>
構文 <code>func _local_ ( [パラメータ:文字列] )</code><br /><p><strong>(書式 2) ターン処理時関数呼び出し</strong></p>
<p>startfunc _local_ の func 版です。</p>
<p>なお、この方法で定義された関数は必要時にしか読み込まれませんので、負荷軽減に繋がります。</p>
<pre class="display">
@@EVENT func _local_(10)
    my($count)=@_;
    my $ret='';
    if(rand(86400)&lt;$TIMESPAN*$count)
    {
        my $idx=int rand(scalar @DT);
        $DT[$idx]-&gt;{money}=int $DT[$idx]-&gt;{money}/2;
        $ret=$DT[$idx]-&gt;{name}.'の所持金が半分になりました';
    }
    return $ret;
_local_
# イベント発動中は、
# 1日に10店舗の確率(割合)で所持金が半分になる
# 対象店舗はランダム
</pre><h3 class="subsection"><small><a href="#top">△</a></small> <a name="83" id="83">param</a></h3>
構文 <code>param [商品名:商品名or商品コード] [要素名:文字列(0-9a-zA-Z_)] [=+-*/] [設定値:文字列or数値]</code><br /><p><strong>商品データの変更(イベント期間中のみ)</strong></p>
<p>イベントが発動中の期間のみ、商品データを一時的に変更します。</p>
<p>param に使用できる[要素名]は <a href="#%40%40ITEM">@@ITEM</a> のものと同一です。</p>
<p>ただし、 base は [基準個数] を表し、新たに half が [半額個数] を表します。</p>
<p>注意点として、 pop 等は値が売れ行き時間(秒数)なので、売れ行き率を上げたい場合は、値を減少させることになります。</p>
<p>なお、実際には「$ITEM[商品番号]->{要素名}=[設定値];」といったコードになります。
つまり、[設定値]にコードを書くことで多彩な処理が可能です。</p>
<pre class="display">
@@EVENT param テスト商品 price*10
# イベント期間中はテスト商品の標準価格が10倍
</pre><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40INCLUDE" id="%40%40INCLUDE">@@INCLUDE</a></h2>
構文 <code>@@INCLUDE &quot;[外部ファイル:文字列]&quot;</code><br /><p>外部ファイルを読み込み、<code class="filename">soldout/inc/inc-item-data.cgi</code> と同じように解釈/変換します。</p>
<p>読み込みたい外部ファイル名を記述します。
必ずダブルクォートで囲い、 1 行で記述してください。
外部ファイルは custom ディレクトリに置いてください。</p>
<pre class="display">
@@INCLUDE &quot;add-item.cgi&quot;
# add-item.cgi というファイルを読み込む
</pre><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCITEM" id="%40%40FUNCITEM">@@FUNCITEM</a></h2>
<p>全商品に共通の関数を定義します。</p>
<p>商品使用時に読み込まれます。
<code class="filename">soldout/inc/inc-item.cgi</code> から読み込まれる形のファイルとして生成されます。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="86" id="86">perlコード記述</a></h3>
<p>perl のコードをそのまま記述します。
@@から始まるコマンドがあると、そこで perl コード記述が終了とみなされます。
ただし、<a href="#%40%40ITEMNO">@@ITEMNO</a> は例外です。詳細は後述の<a href="#%40%40ITEMNO">@@ITEMNO</a>をご覧下さい。</p>
<p>なお、商品使用時の固有処理は <a href="#%40%40USE">@@USE</a> の <a href="#61">func _local_</a> にて記述することをお勧めします。
<a href="#%40%40FUNCITEM">@@FUNCITEM</a> への記述は基本的な処理(汎用ルーチンなど)のみが望ましいです。
<a href="#%40%40FUNCITEM">@@FUNCITEM</a> への追加は商品使用時の負荷増大に繋がります。注意してください。
以下は perl コード記述の際の注意点です。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="87" id="87">package item</a></h3>
<p>package item となりますので、変数/関数スコープ等に注意してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="88" id="88">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。
ちなみに、$USE には <a href="#%40%40USE">@@USE</a> で定義された各種パラメータが格納されています。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="89" id="89">関数戻り値</a></h3>
<p>return "メッセージ:文字列";</p>
<p>としてください。 
このメッセージとは、商品を使用したことをユーザに表示するものです。
表示だけですので、システム上のログに残ることはありません。
ログ(最近の出来事)に残したいときは、<code class="filename">soldout/inc/inc-item.cgi</code>に定義されている WriteLog 関数を利用できます。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="90" id="90">利用可能変数</a></h3>
<p>@DT $DT $DTS $USE @ITEM 等が利用できます。(package item でも読み書きできます)</p>
<p>このファイルは package item ですので、変数や関数のスコープに注意してください。
利用可能変数の詳細は「各種データ変数表」をご覧下さい。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCEVENT" id="%40%40FUNCEVENT">@@FUNCEVENT</a></h2>
<p>全イベントに共通の関数を定義します。</p>
<p>イベントの発動や終了処理時に読み込まれる関数の定義です。
<code class="filename">soldout/inc/inc-event.cgi</code> に読み込まれる形のファイルとして生成されます。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。
以下は perl コード記述の際の注意点です。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="92" id="92">package event</a></h3>
<p>package event となりますので、変数/関数スコープ等に注意してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="93" id="93">関数引数</a></h3>
<p>関数の入力引数は <a href="#%40%40EVENT">@@EVENT</a> の <a href="#77">startfunc</a>/<a href="#79">endfunc</a> で指定したものです。
関数先頭で my($arg1,$arg2)=@_; とでもして受け取ってください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="94" id="94">関数戻り値</a></h3>
<p>return ( 0 or 1 , &quot;メッセージ&quot; );</p>
<p>としてください。メッセージが不要の場合は、</p>
<p>return 0 or 1;</p>
<p>で結構です。
return 0 は、イベント発動失敗、
return 1 は、イベント発動成功という意味です。
持続系のイベント(品薄イベントなど)の場合は return 1 を返してください。
その場合、<code class="filename">soldout/inc/inc-item-data.cgi</code> で指定した時間、イベントが持続します。
単発系(万引きなど)の場合は、関数を実行すればそれで OK ですから、 return 0 です。</p>
<p>メッセージは発動成功失敗に関わらず表示させることが出来ます。
この場合のメッセージとは、「最近の出来事」のメッセージのことです。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="95" id="95">使用可能変数</a></h3>
<p>@DT @ITEM 等が利用できます。
ただし、このファイルは package event ですので、自信がない場合は@main::DT 等でアクセスしてください。
利用可能変数の詳細は「各種データ変数表」をご覧下さい。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCUPDATE" id="%40%40FUNCUPDATE">@@FUNCUPDATE</a></h2>
<p>決算時に実行したい処理や関数を定義します。</p>
<p>決算の直前と直後に読み込まれる関数の定義です。
決算時の定義ファイル読み込み後、
UpdateResetBefore() が決算直前に実行され、
UpdateResetAfter() は決算直後に実行されます。
これらの関数が定義されていなければ処理は行われません。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="97" id="97">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="98" id="98">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="99" id="99">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="100" id="100">利用可能変数</a></h3>
<p>@DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCINIT" id="%40%40FUNCINIT">@@FUNCINIT</a></h2>
<p>入店(ログイン)時に実行したい処理や関数を定義します。</p>
<p>ユーザがログインしたときに読み込み実行される関数の定義です。
ユーザの状態(在庫等)に応じて設定を変更する場合などに使用します。
<a href="#%40%40FUNCINIT">@@FUNCINIT</a> への記述はシステム全体の負荷増大に繋がります。注意してください。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="102" id="102">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="103" id="103">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="104" id="104">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="105" id="105">利用可能変数</a></h3>
<p>$DT @DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCBASE" id="%40%40FUNCBASE">@@FUNCBASE</a></h2>
<p><code class="filename">soldout/_base.cgi</code>内の関数をオーバーライドしたい関数や、
システム全体で共用したい関数を定義します。</p>
<p><code class="filename">soldout/_base.cgi</code> の最後で読み込み実行される関数の定義です。
<code class="filename">soldout/_base.cgi</code> 内の関数オーバーライド等に使用します。
<a href="#%40%40FUNCBASE">@@FUNCBASE</a> への記述はシステム全体の負荷増大に繋がります。注意してください。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="107" id="107">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="108" id="108">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="109" id="109">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="110" id="110">利用可能変数</a></h3>
<p>システム初期化時に処理されますので、ありません。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCTURN" id="%40%40FUNCTURN">@@FUNCTURN</a></h2>
<p>ターン更新時に実行される処理や関数を定義します。</p>
<p>ターン更新時の <a href="#%40%40ITEM">@@ITEM</a> <a href="#39">funct _local_</a> を処理する直前に読み込み/実行される処理や関数の定義です。
<a href="#%40%40ITEM">@@ITEM</a> <a href="#39">funct _local_</a> で使用される共通関数の定義等に利用できます。
<a href="#%40%40FUNCTURN">@@FUNCTURN</a> への記述はターン更新時の負荷増大に繋がります。注意してください。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="112" id="112">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="113" id="113">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="114" id="114">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="115" id="115">利用可能変数</a></h3>
<p>@DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCCUSTOM" id="%40%40FUNCCUSTOM">@@FUNCCUSTOM</a></h2>
<p>カスタムページ<code class="filename">soldout/custom.cgi</code>用の処理や関数を定義します。</p>
<p><code class="filename">soldout/custom.cgi</code>へのアクセス時にこの定義が読み込まれ、
定義された CustomPageInit(command) を実行し、
その後 CustomPage_command() を実行します。</p>
<p>command は、「 custom.cgi?cmd=command 」で渡されます。
例えば、「 custom.cgi?cmd=test 」というリクエストがあった場合は、
CustomPageInit('test') CustomPage_test() が実行されます。
これらの関数が定義されていなければ処理は行われません。</p>
<p class="display">note:command は英小文字(a-z)とアンダースコア(_)で構成され、数字は利用できません。</p>
<p>HTML 出力はグローバル変数の $disp へ追加してください。</p>
<p>各関数で return 0 を行うと、カスタムページの処理を中断し、
return 1 で処理を続行します。</p>
<p>また、 return 'command' で、引き続きその command を実行します。(最高 10 回まで)</p>
<pre class="display">
sub CustomPageInit
{
    my($command)=@_;
    $command||='main';
    return $command;
}
sub CustomPage_main
{
    $disp.=&quot;main,&quot;;
    return 1;
}
sub CustomPage_sub
{
    $disp.=&quot;sub,&quot;;
    return 'main';
}
sub CustomPage_another
{
    $disp.=&quot;another,&quot;;
    return 1;
}
# http://....../soldout/custom.cgi の結果
# main,
#
# http://....../soldout/custom.cgi?cmd=main の結果
# main,
#
# http://....../soldout/custom.cgi?cmd=sub の結果
# sub,main,
#
# http://....../soldout/custom.cgi?cmd=another の結果
# another,
</pre><p>構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="117" id="117">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="118" id="118">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="119" id="119">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="120" id="120">利用可能変数</a></h3>
<p>@DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCNEW" id="%40%40FUNCNEW">@@FUNCNEW</a></h2>
<p>店舗の新規登録時に実行したい処理や関数を定義します。</p>
<p>店舗の初期化が終わり、データを書き込む直前に実行されます。</p>
<p>なお、この@@FUNCNEW の記述中に <code>$DEFINE_FUNCNEW_NOLOG=1;</code> がある場合は、
「？？？？が新装開店しました」というログ出力が実行されません。
<a href="customize4.html#WriteLog">各種関数表 &gt; WriteLog</a> を使って独自に出力したい場合などに利用してください。</p>
<p>構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="122" id="122">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="123" id="123">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="124" id="124">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="125" id="125">利用可能変数</a></h3>
<p>$DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCSHOPIN" id="%40%40FUNCSHOPIN">@@FUNCSHOPIN</a></h2>
<p>店舗が移転してきた時に実行したい処理や関数を定義します。</p>
<p>店舗の受け入れ処理が、データを書き込む直前に実行されます。</p>
<p>「移転してきた店舗に商品を与える」等が実現できます。</p>
<p>構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="127" id="127">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="128" id="128">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="129" id="129">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="130" id="130">利用可能変数</a></h3>
<p>$DT @DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCSHOPOUT" id="%40%40FUNCSHOPOUT">@@FUNCSHOPOUT</a></h2>
<p>店舗が他の街へ移転する時に実行したい処理や関数を定義します。</p>
<p>店舗データを送信する直前に実行されます。</p>
<p>「移転していく店舗に餞別を与える」等が実現できます。</p>
<p>また、他の街へは送信したくない情報($DT->{user}等)を削除して移転させることも出来ます。</p>
<p>構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="132" id="132">package main</a></h3>
<p>package main となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="133" id="133">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="134" id="134">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="135" id="135">利用可能変数</a></h3>
<p>$DT @DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCSALE" id="%40%40FUNCSALE">@@FUNCSALE</a></h2>
<p><a href="#%40%40ITEM">@@ITEM</a> <a href="#%40%40ITEM%20funcs%20_local_">@@ITEM funcs _local_</a> から利用できる関数を定義します。</p>
<p><a href="#%40%40FUNCSALE">@@FUNCSALE</a> への記述はターン更新時の負荷増大に繋がります。注意してください。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="137" id="137">package item</a></h3>
<p>package item となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="138" id="138">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="139" id="139">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="140" id="140">利用可能変数</a></h3>
<p>$DT @DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40FUNCBUY" id="%40%40FUNCBUY">@@FUNCBUY</a></h2>
<p><a href="#%40%40ITEM">@@ITEM</a> <a href="#%40%40ITEM%20funcb%20_local_">@@ITEM funcb _local_</a> から利用できる関数を定義します。</p>
<p><a href="#%40%40FUNCBUY">@@FUNCBUY</a> への記述は商品購入時(他店 or 市場)の負荷増大に繋がります。注意してください。
構文等は <a href="#%40%40FUNCITEM">@@FUNCITEM</a> と同じですので、そちらを参照してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="142" id="142">package item</a></h3>
<p>package item となります。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="143" id="143">関数引数</a></h3>
<p>ありません。
関数内での処理に必要な情報はグローバル変数から取得してください。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="144" id="144">関数戻り値</a></h3>
<p>ありません。</p>
<h3 class="subsection"><small><a href="#top">△</a></small> <a name="145" id="145">利用可能変数</a></h3>
<p>$DT @DT @ITEM 等が利用できます。</p>
<h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40IF" id="%40%40IF">@@IF</a></h2>
構文 <code>@@IF [変数名:文字列(0-9a-zA-Z_)] [比較方法:== != eq ne] [比較値:文字列or数値] [条件が真の場合のコンバートデータ]</code><br /><p>条件コンバート用のコマンドです。</p>
<p>変数を比較し、条件を満たした場合のみコンバートすることが出来ます。
ただし、コンバート可能なのはその行のみです。複数行の指定は不可です。</p>
<dl><dt>
変数名</dt>
<dd>
<a href="#%40%40DEFINE">@@DEFINE</a> <a href="#13">Set</a> で定義された変数の名前を指定します。
</dd>
<dt>
比較方法</dt>
<dd>
変数と比較値の比較方法を記述します。
<ul><li>
== 数値比較し、同じ場合
</li>
<li>
!= 数値比較し、違う場合
</li>
<li>
eq 文字列比較し、同じ場合
</li>
<li>
ne 文字列比較し、違う場合
</li></ul></dd>
<dt>
比較値</dt>
<dd>
比較する文字列もしくは数値を記述します。変数は使用できません。
</dd>
<dt>
条件が真の場合のコンバートデータ</dt>
<dd>
条件を満たした場合にコンバートするデータ(記述)です。
通常の記述が可能ですが、1行で記述する必要があります。
</dd></dl><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40SETMACRO" id="%40%40SETMACRO">@@SETMACRO</a></h2>
構文 <code>@@SETMACRO [マクロ名:文字列(0-9a-zA-Z_)] &quot;[マクロ内容]&quot;</code><br /><p><code class="filename">soldout/inc/inc-item-data.cgi</code>内で利用するマクロを定義するコマンドです。</p>
<p>よく使う記述をマクロとして定義できます。マクロの使用は後述の <a href="#%40%40USEMACRO">@@USEMACRO</a> で行います。</p>
<dl><dt>
マクロ名</dt>
<dd>
マクロの名称を記述します。(使用可能文字 0-9A-Za-z_ )
</dd>
<dt>
マクロ内容</dt>
<dd>
マクロの内容データ(記述)です。
通常の記述が可能です。
必ずダブルクォートで囲い、1行で記述してください。
</dd></dl><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40USEMACRO" id="%40%40USEMACRO">@@USEMACRO</a></h2>
構文 <code>@@USEMACRO [マクロ名:文字列(0-9a-zA-Z_)]</code><br /><p><a href="#%40%40SETMACRO">@@SETMACRO</a>で定義したマクロを使用するコマンドです。</p>
<dl><dt>
マクロ名</dt>
<dd>
使用するマクロの名称を記述します。
</dd></dl><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40ITEMNO" id="%40%40ITEMNO">@@ITEMNO</a></h2>
構文 <code>@@ITEMNO &quot;[商品名]:商品名or商品コード&quot;</code><br /><p>商品名を商品番号に変換するコマンドです。</p>
<p>特殊なコマンドです。
このコマンドは @@FUNC* 内で「商品番号の記述が必要だが商品名で記述したい」場合に使用します。
このコマンドが見つかると、商品名が商品番号に変換され、コマンド自体が商品番号に置き換えられます。</p>
<dl><dt>
"商品名"</dt>
<dd>
商品番号に変換したい商品名を記述します。
必ずダブルクォートで囲い、1行で記述してください。
</dd></dl><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40VALUE" id="%40%40VALUE">@@VALUE</a></h2>
構文 <code>@@VALUE &quot;変数名:文字列(0-9a-zA-Z_)&quot;</code><br /><p><a href="#%40%40DEFINE">@@DEFINE</a> <a href="#13">Set</a> で定義した変数をプログラム内に展開するコマンドです。</p>
<p>特殊なコマンドです。
このコマンドは @@FUNC* 内で「@@DEFINE Set で定義した変数の内容を記述したい」場合に使用します。</p>
<p>このコマンドが見つかると、コマンド自体が '変数内容' とシングルクォートで囲まれた形で書き換えられます。
変数が未定義だった場合は '' という空文字列に置き換えられます。</p>
<dl><dt>
"変数名"</dt>
<dd>
展開したい変数名を記述します。
必ずダブルクォートで囲い、1行で記述してください。
</dd></dl><h2 class="section"><small><a href="#top">△</a></small> <a name="%40%40END" id="%40%40END">@@END</a></h2>
<p><code class="filename">soldout/inc/inc-item-data.cgi</code>の記述終了を示すコマンドです。
このコマンド以降は無視され、コンバートを終了します。</p>
<p><small><a href="#top">△</a></small></p>
<hr /><p><a href="index.html">総合目次</a> &gt; <a href="customize.html">カスタマイズ目次</a> &gt; 商品データ記述文法</p>
<hr /><div class="footer">
<address>
Copyright (C) 2001-2002 MUTOYS.<br />
<a href="http://mutoys.com/">MUTOYS(ムートイズ) http://mutoys.com/</a><br />
<a href="mailto:info@mutoys.com">info@mutoys.com</a><br />
管理人：MU<br />
画像作成：NAYUTA<br />
</address>
</div>
</body>
</html>
